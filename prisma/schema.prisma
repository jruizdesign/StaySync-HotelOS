generator client {
  provider = "prisma-client-js" // FIX 1: Correct provider name
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

// --- MODELS ---

model Property {
  id          String    @id @default(uuid()) @db.Uuid // FIX 3: Native UUID
  name        String
  address     String?
  email       String?
  phoneNumber String?   @map("phone_number") // JS: phoneNumber, DB: phone_number
  
  bookings    Booking[]
  rooms       Room[]
  users       User[]
  maintenanceRequests MaintenanceRequest[]

  @@map("properties") // Keeps your DB table named 'properties'
}

model Room {
  id         String     @id @default(uuid()) @db.Uuid
  roomNumber String     @map("room_number")
  roomType   String     @map("room_type")
  capacity   Int?
  floor      Int?
  price      Decimal?   @db.Decimal(10, 2) // FIX 4: Decimal for money
  status     String?    @map("room_status")

  // Tenancy
  propertyId String     @map("property_id") @db.Uuid
  property   Property   @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  
  bookings   Booking[]

  @@index([propertyId])
  @@map("rooms")
}

model Booking {
  id           String    @id @default(uuid()) @db.Uuid
  checkInDate  DateTime  @map("check_in_date") @db.Date
  checkOutDate DateTime  @map("check_out_date") @db.Date
  guestName    String    @map("guest_name")
  status       String

  // Tenancy
  propertyId   String    @map("property_id") @db.Uuid
  property     Property  @relation(fields: [propertyId], references: [id], onDelete: Cascade)

  roomId       String?   @map("room_id") @db.Uuid
  room         Room?     @relation(fields: [roomId], references: [id])

  guestId      String?   @map("guest_id") @db.Uuid
  guest        Guest?    @relation(fields: [guestId], references: [id])

  invoices     Invoice[]

  @@index([propertyId])
  @@index([roomId])
  @@index([guestId])
  @@map("bookings")
}

model User {
  id         String     @id
  email      String     @unique
  name       String?
  role       String     @default("STAFF")

  properties Property[]
  maintenanceRequests MaintenanceRequest[] @relation("assigned_user")
  reportedMaintenance MaintenanceRequest[] @relation("reporter")
  featureRequests FeatureRequest[]

  @@map("users")
}

model Guest {
  id          String   @id @default(uuid()) @db.Uuid
  email       String   @unique
  name        String
  phoneNumber String?  @map("phone_number")
  address     String?
  idNumber    String?  @map("id_number")
  status      String   @default("Regular") // Regular, VIP, Restricted
  isDNR       Boolean  @default(false)     @map("is_dnr")
  dnrReason   String?  @map("dnr_reason")
  photoUrl    String?  @map("photo_url")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  bookings    Booking[]
  notes       GuestNote[]
  invoices    Invoice[]
  documents   GuestDocument[]

  @@map("guests")
}

model GuestDocument {
  id         String   @id @default(uuid()) @db.Uuid
  type       String   // Passport, ID Card, Invoice, Receipt, Other
  fileName   String   @map("file_name")
  fileUrl    String   @map("file_url")
  uploadDate DateTime @default(now()) @map("upload_date")
  amount     Decimal? @db.Decimal(10, 2) // Optional, for invoices/receipts
  
  guestId    String   @map("guest_id") @db.Uuid
  guest      Guest    @relation(fields: [guestId], references: [id], onDelete: Cascade)

  @@index([guestId])
  @@map("guest_documents")
}

model GuestNote {
  id        String   @id @default(uuid()) @db.Uuid
  content   String
  createdAt DateTime @default(now()) @map("created_at")
  
  guestId   String   @map("guest_id") @db.Uuid
  guest     Guest    @relation(fields: [guestId], references: [id], onDelete: Cascade)

  @@map("guest_notes")
}

model MaintenanceRequest {
  id           String    @id @default(uuid()) @db.Uuid
  description  String
  priority     String    @default("Medium") // Low, Medium, High, Critical
  status       String    @default("Pending") // Pending, In Progress, Completed
  roomNumber   String    @map("room_number")
  reportedDate DateTime  @default(now()) @map("reported_date") @db.Date
  completedDate DateTime? @map("completed_date") @db.Date
  cost         Decimal?  @default(0) @db.Decimal(10, 2)
  notes        String?

  propertyId   String    @map("property_id") @db.Uuid
  property     Property  @relation(fields: [propertyId], references: [id], onDelete: Cascade)

  reporterId   String?   @map("reporter_id")
  reporter     User?     @relation("reporter", fields: [reporterId], references: [id])

  assignedToId String?   @map("assigned_to_id")
  assignedTo   User?     @relation("assigned_user", fields: [assignedToId], references: [id])

  @@index([propertyId])
  @@map("maintenance_requests")
}

model FeatureRequest {
  id          String   @id @default(uuid()) @db.Uuid
  title       String
  description String
  priority    String   @default("Medium")
  status      String   @default("New")
  votes       Int      @default(0)
  createdAt   DateTime @default(now()) @map("created_at")

  requesterId String?  @map("requester_id")
  requester   User?    @relation(fields: [requesterId], references: [id])

  @@map("feature_requests")
}

model Invoice {
  id            String   @id @default(uuid()) @db.Uuid
  totalAmount   Decimal  @map("total_amount") @db.Decimal(10, 2)
  status        String   @default("UNPAID") // UNPAID, PAID, CANCELLED
  generatedAt   DateTime @default(now()) @map("generated_at")
  
  guestId       String   @map("guest_id") @db.Uuid
  guest         Guest    @relation(fields: [guestId], references: [id])
  
  bookingId     String?  @unique @map("booking_id") @db.Uuid
  booking       Booking? @relation(fields: [bookingId], references: [id])

  payments      Payment[]

  @@map("invoices")
}

model Payment {
  id            String   @id @default(uuid()) @db.Uuid
  amount        Decimal  @db.Decimal(10, 2)
  method        String   // CREDIT_CARD, CASH, TRANSFER
  status        String   @default("COMPLETED")
  transactionId String?  @map("transaction_id")
  processedAt   DateTime @default(now()) @map("processed_at")

  invoiceId     String   @map("invoice_id") @db.Uuid
  invoice       Invoice  @relation(fields: [invoiceId], references: [id])

  @@map("payments")
}