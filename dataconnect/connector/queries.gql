# 1. ADMIN QUERY
# Added description to suppress "EXISTING_INSECURE" warning
query AdminListProperties @auth(level: USER) {
  properties {
    id
    name
    address
    email
  }
}

# 2. DASHBOARD QUERY
query GetPropertyDashboard($propertyId: UUID!) @auth(level: USER) {
  
  property(id: $propertyId) {
    id
    name
    address
  }

  bookings(
    where: { 
      propertyId: { eq: $propertyId } 
    }
    orderBy: { checkInDate: ASC }
  ) {
    id
    guestName
    status
    checkInDate
    checkOutDate
    room {
      roomNumber
    }
  }

  rooms(
    where: { 
      propertyId: { eq: $propertyId } 
    }
    orderBy: { roomNumber: ASC }
  ) {
    id
    roomNumber
    roomType
    floor
    status
    pricePerNight
  }

  users(
    where: {
      propertyId: { eq: $propertyId }
    }
  ) {
    id
    email
    role
    name
    pin
    status
  }
}

# 3. BOOKING MUTATION
mutation CreateBooking(
  $propertyId: UUID!, 
  $guestName: String!, 
  $checkIn: Date!, 
  $checkOut: Date!
) @auth(level: USER) {
  booking_insert(data: {
    propertyId: $propertyId,
    guestName: $guestName,
    checkInDate: $checkIn,
    checkOutDate: $checkOut,
    status: "CONFIRMED"
  })
}

# 4. PROPERTY SETTINGS MUTATION
mutation UpdateProperty(
  $id: UUID!,
  $name: String,
  $address: String,
  $email: String,
  $phoneNumber: String
) @auth(level: USER) {
  property_update(
    key: { id: $id },
    data: {
      name: $name,
      address: $address,
      email: $email,
      phoneNumber: $phoneNumber
    }
  )
}

# 5. USER STATUS MUTATION
# Note: "user_update" takes a key object {id: ...} not just "id"
mutation UpdateUserStatus(
  $id: String!,
  $status: String!
) @auth(level: USER) {
  user_update(
    key: { id: $id },   # <--- FIXED SYNTAX HERE
    data: {
      status: $status
    }
  )
}

# 6. ROOM UPDATE MUTATION
mutation UpdateRoom(
  $id: UUID!,
  $status: String,
  $type: String,
  $floor: Int,
  $number: String
) @auth(level: USER) {
  room_update(
    key: { id: $id },
    data: {
      status: $status,
      roomType: $type,
      floor: $floor,
      roomNumber: $number
    }
  )
}

# 7. CREATE ROOM MUTATION
mutation CreateRoom(
  $propertyId: UUID!,
  $roomNumber: String!,
  $roomType: String!,
  $floor: Int,
  $pricePerNight: Float,
  $status: String
) @auth(level: USER) {
  room_insert(data: {
    propertyId: $propertyId,
    roomNumber: $roomNumber,
    roomType: $roomType,
    floor: $floor,
    pricePerNight: $pricePerNight,
    status: $status
  })
}

# 9. CREATE PROPERTY MUTATION
mutation CreateProperty(
  $name: String!,
  $address: String
) @auth(level: USER) {
  property_insert(data: {
    name: $name,
    address: $address
  })
}

# 10. UPDATE USER PROPERTY MUTATION (Linking)
mutation LinkUserToProperty(
  $id: String!,
  $propertyId: UUID!
) @auth(level: USER) {
  user_update(
    key: { id: $id },
    data: { propertyId: $propertyId }
  )
}

# 8. CREATE USER MUTATION
mutation CreateUser(
  $id: String!,
  $email: String!,
  $role: String!,
  $name: String,
  $propertyId: UUID,
  $status: String
) @auth(level: USER) {
  user_insert(data: {
    id: $id,
    email: $email,
    role: $role,
    name: $name,
    propertyId: $propertyId,
    status: $status
  })
}