# --- 1. SUPER ADMIN QUERIES ---
# These are only called if the user's role is SUPER_ADMIN.
# They fetch everything without filtering by property.

query AdminListAllProperties @auth(level: USER) {
  properties {
    id
    name
    address
    # We can fetch a summary of users for each property
    users: users_on_property {
      email
      role
    }
  }
}

# --- 2. TENANT QUERIES (Manager / Staff) ---
# These queries require a $propertyId to be passed in.
# The FRONTEND must pass the ID from the User's Auth Token (Claims).

query GetPropertyDashboard($propertyId: UUID!) @auth(level: USER) {
  # 1. Fetch the Property Details
  property(id: $propertyId) {
    name
    address
  }
  
  # 2. Fetch ONLY Bookings for this property
  bookings(
    where: { 
      propertyId: { eq: $propertyId } 
    }
    orderBy: { checkInDate: ASC }
  ) {
    id
    guestName
    status
    checkInDate
    checkOutDate
    room {
      roomNumber
    }
  }
  
  # 3. Fetch ONLY Rooms for this property
  rooms(
    where: { 
      propertyId: { eq: $propertyId } 
    }
  ) {
    id
    roomNumber
    status
  }
}

# --- 3. MUTATIONS (Creating Data) ---

# Example: A Manager creates a Booking
# We strictly bind the new booking to the $propertyId
mutation CreateBooking(
  $propertyId: UUID!, 
  $guestName: String!, 
  $checkIn: Date!, 
  $checkOut: Date!
) @auth(level: USER) {
  booking_insert(data: {
    propertyId: $propertyId,
    guestName: $guestName,
    checkInDate: $checkIn,
    checkOutDate: $checkOut,
    status: "CONFIRMED"
  })
}
